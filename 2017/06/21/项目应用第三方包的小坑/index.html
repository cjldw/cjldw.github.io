<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 项目引用第三方包的小坑 · luowen&weiwei-(luowen ❤️ wwei)</title><meta name="description" content="composer使用第三方遇到的一个小坑"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><!--if theme.googlefonts//link(rel="stylesheet", href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type='text/css')--><!--else //link(rel="stylesheet", href="https://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type='text/css')--><meta name="generator" content="Hexo 6.3.0"></head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="http://weibo.com/loovien" target="_blank">WEIBO</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/loovien" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/me/" target="_self">ABOUTME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">项目引用第三方包的小坑</h1><div class="post-info">Jun 21, 2017</div><div class="post-content"><p>一般我们开发项目, 不可避免的需要使用别的第三方库, java有<code>maven</code>, python有<code>pip</code>, go有<code>go get</code>, javascritp有<code>npm</code>,<br>当然作为世界上最好的语言PHP有<code>composer</code>, 看上去是那么的美好.😄. 今天用composer安装自己写的一个依赖, 发现有坑.<br>……….</p>
<span id="more"></span>

<h3 id="写在前面的话"><a href="#写在前面的话" class="headerlink" title="写在前面的话"></a>写在前面的话</h3><p>场景, 有快业务代码, 很多很多个项目都要调用, (比如业务监控代码, 需要在个个业务中调用), 理所当的想把它封装成一个composer包(针对php开发)<br>然后其他项目只要<code>composer require monitorpkg</code>即可, 然后将代码加入到仓库, 和项目一起发布OK了,<br>(一般我们都把<code>vendor</code>目录下一起加入到仓库. 1. 方便前端同学 一起开发, 总不能让前端同学一安装composer吧.  2. 线上发布也简单, 当然你可以说发布后挂个钩子, <code>composer update</code>一下也很简单, 但实际情况不会理想, 曾经我们项目就是这样做, 发现每次发布项目要等好几分钟, 随着项目变大, 10多分钟才发布OK, 这绝对不是你想要的)<br>问题来了, 我发现<code>composer install monitorpkg</code>的代码不能加入到项目仓库. ~~~</p>
<h3 id="原因追踪"><a href="#原因追踪" class="headerlink" title="原因追踪"></a>原因追踪</h3><p><code>composer install</code>下来的第三方包不能加入仓库, 没道理, 以前也是这么干的呀, cd到安装的第三方包目录下(<code>vendor/organization/monitorpkg</code>) <code>ls -a</code> 发现.git目录也<br>down下来了? 为什么?</p>
<h3 id="composer仓库类型"><a href="#composer仓库类型" class="headerlink" title="composer仓库类型"></a><a target="_blank" rel="noopener" href="https://getcomposer.org/doc/05-repositories.md">composer仓库类型</a></h3><p>composer 仓库地址有类型有4类别</p>
<ul>
<li>Composer</li>
<li>VCS</li>
<li>PEAR</li>
<li>Packages</li>
</ul>
<p>一般我们使用的的<code>composer</code>类型, 安装的包不会有.git目录, 但项目是私有项目, 图个方便, 直接使用<code>vcs</code>类型了, 发现使用<code>vcs</code>类型会把项目的.git目录也down下来<br>我们知道, 单个项目git仓库中只能有.git目录, 由于composer安装的第三方包也有.git目录, 因此项目直接忽略了第三方包了.</p>
<p>composer.json 文件如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;luowen/test&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;authors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;luowen&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bigpao.luo@gmail.com&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;repositories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;vcs&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://github.com/vvotm/zqim.git&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;luowen/zqphplib&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dev-master&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="怎么解决呢-办法肯定是有的"><a href="#怎么解决呢-办法肯定是有的" class="headerlink" title="怎么解决呢, 办法肯定是有的."></a>怎么解决呢, 办法肯定是有的.</h3><ol>
<li><p>使用<code>git submodule</code>实现</p>
<p> 添加我们写的第三方包的git地址作为项目的子模块可参考<a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-submodule">gitsubmodule documention</a>, <a target="_blank" rel="noopener" href="https://github.com/blog/2104-working-with-submodules">Working with submodules</a></p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> vendor/organiztion/</span><br><span class="line">$ git submodule add https://my-privite-gitrepo.com/mycustomer-package.git monitorypkg</span><br></pre></td></tr></table></figure>
<p> 还没完事, 每次发布项目后 需要执行 <code>git submodule update --init --recursive</code> 把子模块的项目代码拉去下来<br> 很显然, 这不是我们想要的</p>
</li>
<li><p>使用<a target="_blank" rel="noopener" href="https://github.com/composer/satis">Composer官方Satis</a> 搭建私有composer仓库, 将composer repositios 换成 <code>composer</code>类型, 例子:</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;luowen/test&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;authors&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;luowen&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;email&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bigpao.luo@gmail.com&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;repositories&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;composer&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;http://youpackage.domain.com&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;require&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;luowen/zqphplib&quot;</span><span class="punctuation">:</span> <span class="string">&quot;dev-master&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>关于更多的gitsubmodule例子(拆分项目成多个子模块, 等等..)参考<a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-submodule">gitsubmodule</a>, <a target="_blank" rel="noopener" href="https://github.com/blog/2104-working-with-submodules">Working with submodules</a></strong><br><strong>综合考虑尽量避免使用gitsubmodule这个功能, 成本比较高, 并没想的那么美好</strong></p>
<p><strong>欢迎拍砖, 我的disqus插件被强了, 一般人拍不了!😄😄😄</strong></p>
</div></article></div></section><footer><div class="paginator"><a class="prev" href="/2017/07/05/sleepsort/">PREV</a><a class="next" href="/2017/06/18/gohttpserver/">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'superwm';
var disqus_identifier = '2017/06/21/项目应用第三方包的小坑/';
var disqus_title = '项目引用第三方包的小坑';
var disqus_url = 'https://loovien.github.io/2017/06/21/项目应用第三方包的小坑/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2023 <a href="https://loovien.github.io">luowen<loovien@163.com></a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script async src="/js/embed.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-78479444-1",'auto');ga('send','pageview');</script></body></html>