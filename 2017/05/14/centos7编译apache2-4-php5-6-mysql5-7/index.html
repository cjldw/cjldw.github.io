<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> centos7编译apache2.4+php5.6+mysql5.7 · luowen&weiwei-(luowen ❤️ wwei)</title><meta name="description" content="centos7编译apache2.4 php5.6 mysql5.7构建开发环境"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><!--if theme.googlefonts//link(rel="stylesheet", href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,600" type='text/css')--><!--else //link(rel="stylesheet", href="https://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type='text/css')--><meta name="generator" content="Hexo 6.0.0"></head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="http://weibo.com/loovien" target="_blank">WEIBO</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/loovien" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="/me/" target="_self">ABOUTME</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">centos7编译apache2.4+php5.6+mysql5.7</h1><div class="post-info">May 14, 2017</div><div class="post-content"><p>先说点对本地开发环境新得. 对于开发环境, 我个人还是偏喜欢在本地环境搭建, 如果本地环境是window, 最需要的是<br>文件名大小写敏感问题. 不知不觉踩了好几次坑了. 也曾想过跑个虚拟机跑开发环境, 代码通过共享解决(virtualbox, vagrant…), 本地环境和<br>线上环境一致的问题. 但真实用起来还是不爽. 前几天有个网友让班忙做个镜像, 本着助人为乐的态度就弄了.</p>
<span id="more"></span>

<h2 id="准备环境-CentOS7-minimal-IOS"><a href="#准备环境-CentOS7-minimal-IOS" class="headerlink" title="准备环境 (CentOS7 minimal IOS)"></a>准备环境 (CentOS7 minimal IOS)</h2><ul>
<li><p>切换阿里云镜像源</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mv /etc/yum.repos.d/CentOS-Base.repo /etc/yum.repos.d/CentOS-Base.repo.backup</span></span><br><span class="line"><span class="comment"># wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span></span><br><span class="line"><span class="comment"># yum makecache</span></span><br></pre></td></tr></table></figure>
<p>如果没有安装<code>wget</code> 也可使用 <code>curl /etc/yum.repos.d/CentOS-Base.repo.backup -o /etc/yum.repos.d/CentOS-Base.repo</code></p>
</li>
<li><p>安装必要的编译工具</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum groupinstall &quot;Development Tools&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="编译apache2-4"><a href="#编译apache2-4" class="headerlink" title="编译apache2.4"></a>编译apache2.4</h2><ul>
<li><p>下载<a target="_blank" rel="noopener" href="http://apache.fayea.com//httpd/httpd-2.4.25.tar.bz2">apache2.4源码</a></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs</span></span><br><span class="line"><span class="comment"># tar -jxvf httpd-2.4.25.tar.bz2</span></span><br></pre></td></tr></table></figure></li>
</ul>
<ul>
<li><p>下载<a target="_blank" rel="noopener" href="http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-1.5.2.tar.gz">apr</a> 拷贝到 <code>path/to/apache2.4/srclib/apr</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs</span></span><br><span class="line"><span class="comment"># wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-1.5.2.tar.gz</span></span><br><span class="line"><span class="comment"># tar -zxvf apr-1.5.2.tar.gz</span></span><br><span class="line"><span class="comment"># mv apr-1.5.2 /opt/softs/httpd-2.4.25/srclib/apr</span></span><br></pre></td></tr></table></figure></li>
<li><p>下载<a target="_blank" rel="noopener" href="http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-util-1.5.4.tar.gz">apr-util</a> 拷贝到 <code>/opt/apache2.4/srclib/apr-util</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs</span></span><br><span class="line"><span class="comment"># wget http://mirrors.tuna.tsinghua.edu.cn/apache//apr/apr-util-1.5.4.tar.gz</span></span><br><span class="line"><span class="comment"># tar -zxvf apr-util-1.5.4.tar.gz</span></span><br><span class="line"><span class="comment"># mv apr-util-1.5.4 /opt/softs/httpd-2.4.25/srclib/apr-util</span></span><br></pre></td></tr></table></figure></li>
<li><p>下载<a target="_blank" rel="noopener" href="https://ftp.pcre.org/pub/pcre/pcre-8.00.tar.bz2">pcre</a> 编译安装</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs</span></span><br><span class="line"><span class="comment"># wget https://ftp.pcre.org/pub/pcre/pcre-8.00.tar.bz2</span></span><br><span class="line"><span class="comment"># tar -jxvf pcre-8.00.tar.bz2</span></span><br><span class="line"><span class="comment"># cd pcre-8.00 </span></span><br><span class="line"><span class="comment"># ./configure  --enable-utf8 --enable-unicode-properties</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure></li>
<li><p>编译apache2.4</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs/httpd-2.4.25</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/opt/apache2.4 --prefix=/opt/apache2.4 --with-inlucde-apr</span></span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure></li>
<li><p>编写systemd启动脚本. SysV不适用, CentOS7默认启用了systemd管理服务. 可以使用</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/systemd/system/httpd.service</span></span><br><span class="line"></span><br><span class="line">    [Unit]</span><br><span class="line">    Description = apache2.4 service</span><br><span class="line">    After = network.target</span><br><span class="line"></span><br><span class="line">    [Service]</span><br><span class="line">    Type = forking</span><br><span class="line">    ExecStart = /opt/apache2.4/bin/apachectl -k start</span><br><span class="line"></span><br><span class="line">    [Install]</span><br><span class="line">    WantedBy = multi-user.taget</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl start http</span></span><br></pre></td></tr></table></figure></li>
<li><p>检查是否服务启动</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># curl http://localhost</span></span><br><span class="line">    &lt;html&gt;&lt;body&gt;&lt;h1&gt; It works! &lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>注意: 如果不是本机访问不了, 查看是否是iptables关系. CentOS7-minimal IOS默认有防火墙策略</p>
<ol>
<li>清空所有防火墙策略 <code>iptables -F</code> (开发环境推荐)</li>
<li>或添加一条规则 <code>iptables -t filter -I INPUT 1 -p tcp --dport=80 -j ACCEPT</code>. 所有到目标端口80的tcp协议全部放行.</li>
</ol>
</li>
</ul>
<h2 id="安装mysql5-7"><a href="#安装mysql5-7" class="headerlink" title="安装mysql5.7"></a>安装mysql5.7</h2><p>完全编译mysql5.7是个大工程, 我这篇幅写不完, 偷个懒</p>
<ul>
<li><p>下载官方编译好的<a target="_blank" rel="noopener" href="https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz">MySQL5.7</a>二进制包解压即可.</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs/</span></span><br><span class="line"><span class="comment"># wget https://dev.mysql.com/get/Downloads/MySQL-5.7/mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz</span></span><br><span class="line"><span class="comment"># tar -zxvf mysql-5.7.18-linux-glibc2.5-x86_64.tar.gz</span></span><br><span class="line"><span class="comment"># mv mysql-5.7.18-linux-glibc2.5-x86_64 /opt/mysql5.7</span></span><br></pre></td></tr></table></figure></li>
<li><p>初始化mysql</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/mysql5.7</span></span><br><span class="line"><span class="comment"># useradd mysql -s /sbin/nologin</span></span><br><span class="line"><span class="comment"># mkdir data &amp;&amp; chown mysql:mysql data -R</span></span><br><span class="line"><span class="comment"># bin/mysqld --initialize-insecure</span></span><br></pre></td></tr></table></figure></li>
<li><p>配置<code>/etc/my.cnf</code></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/my.cnf</span></span><br><span class="line"></span><br><span class="line">    [client]</span><br><span class="line">    socket=/tm/mysql.socket</span><br><span class="line">    port=3306</span><br><span class="line"></span><br><span class="line">    [mysqld]</span><br><span class="line">    basedir=/opt/mysql5.7</span><br><span class="line">    datadir=/opt/mysql5.7/data</span><br><span class="line">    socket=/tmp/mysql.socket</span><br><span class="line">    pid-file=/tmp/mysql.pid</span><br><span class="line"></span><br><span class="line">    server-id=1</span><br><span class="line">    user=mysql</span><br><span class="line">    character-set-server=utf8</span><br><span class="line">    collection_server=utf8_general_ci</span><br><span class="line">    log_error=/opt/mysql5.7/data/error.log</span><br><span class="line">    log_bin=/opt/mysql5.7/data/log-bin.log</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>编写systemd启动脚本. SysV不适用, CentOS7默认启用了systemd管理服务. 可以使用</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /etc/systemd/system/mysql.service</span></span><br><span class="line"></span><br><span class="line">    [Unit]</span><br><span class="line">    Description = MySQL service</span><br><span class="line">    After = network.target</span><br><span class="line"></span><br><span class="line">    [Service]</span><br><span class="line">    Type = forking</span><br><span class="line">    ExecStart = /opt/mysql5.7/bin/mysqld --daemonize</span><br><span class="line"></span><br><span class="line">    [Install]</span><br><span class="line">    WantedBy = multi-user.taget</span><br><span class="line"></span><br><span class="line"><span class="comment"># systemctl start mysql</span></span><br></pre></td></tr></table></figure></li>
<li><p>测试是否启动</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /opt/mysql5.7/bin/mysql -uroot -p</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="编译php5-6"><a href="#编译php5-6" class="headerlink" title="编译php5.6"></a>编译php5.6</h2><ul>
<li><p>下载<a target="_blank" rel="noopener" href="http://hk1.php.net/get/php-5.6.30.tar.bz2/from/this/mirror">php5.6</a></p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cd /opt/softs/</span></span><br><span class="line"><span class="comment"># wget http://hk1.php.net/get/php-5.6.30.tar.bz2/from/this/mirror</span></span><br><span class="line"><span class="comment"># tar -jxvf php-5.6.30.tar.gz2</span></span><br><span class="line"><span class="comment"># cd php-5.6.30</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/opt/php5.6 \</span></span><br><span class="line">    </span><br></pre></td></tr></table></figure></li>
<li><p>安装必要的依赖</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># yum install libxml2-devel freetype-devel libpng-devel openssl-devel </span></span><br><span class="line"><span class="comment"># cd /opt/softs/php-5.6.30</span></span><br><span class="line"><span class="comment"># ./configure --prefix=/opt/php5.6 --with-apxs2=/opt/apache2.4/bin/apxs \</span></span><br><span class="line">    --with-zlib=/usr \</span><br><span class="line">    --enable-bcmath \</span><br><span class="line">    --enable-calendar \</span><br><span class="line">    --enable-mbstring \</span><br><span class="line">    --enable-mbregex \</span><br><span class="line">    --with-mysql=mysqlnd</span><br><span class="line"><span class="comment"># make &amp;&amp; make install</span></span><br></pre></td></tr></table></figure></li>
<li><p>添加mine类型到apache</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vi /opt/apache2/conf/httpd.conf</span></span><br><span class="line"></span><br><span class="line">    AddType text/html .php .phtml</span><br><span class="line">    AddType application/x-httpd-php .php .phtml</span><br></pre></td></tr></table></figure></li>
<li><p>测试是否ok</p>
  <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># echo &quot;&lt;?php phpinfo(); &quot; &gt; /opt/apache2.4/htdocs/start.php</span></span><br><span class="line"><span class="comment"># curl http://localhost/start.php</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="重启启动服务"><a href="#重启启动服务" class="headerlink" title="重启启动服务"></a>重启启动服务</h2><ul>
<li>启动mysql <code>systemctl start mysql</code></li>
<li>启动apache <code>sysmtectl start httpd</code></li>
</ul>
</div></article></div></section><footer><div class="paginator"><a class="prev" href="/2017/06/01/apache-reverse-proxy/">PREV</a><a class="next" href="/2017/05/12/gospider/">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'superwm';
var disqus_identifier = '2017/05/14/centos7编译apache2-4-php5-6-mysql5-7/';
var disqus_title = 'centos7编译apache2.4+php5.6+mysql5.7';
var disqus_url = 'https://loovien.github.io/2017/05/14/centos7编译apache2-4-php5-6-mysql5-7/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>© 2015 - 2022 <a href="https://loovien.github.io">luowen<loovien@163.com></a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script><script async src="/js/embed.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-78479444-1",'auto');ga('send','pageview');</script></body></html>