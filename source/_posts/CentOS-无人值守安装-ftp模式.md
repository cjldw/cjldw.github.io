---
title: CentOS 无人值守安装(ftp模式)
tags: []
date: 2015-07-26 02:05:00
---

写好一个脚本, 让centos自己完全自动安装, 就这么干!

<!-- more -->

## <span style="font-size: 14px; line-height: 1.5;">每次安装CentOS时候,都需要鼠标勾选配置.一台机器安装还可以接受,如果有多台,就不好了,下面就介绍下CentOS ftp形式无人值守安装</span>

* 测试环境
    *   2台机器

    *   机器1: ip 192.168.1.103/24 跑了vsftpd服务,并且共享了/var/ftp, 目录内容
        1. ks.cfg CentOS kickstart配置文件[就是安装的配置文件, 每次安装系统后,都会生成 /root/anaconda-ks.cfg]
        2.  pub/CentOS/* CentOS光盘中所有内容的复制[理论是可以挂在的, 但实验挂在不行,读取不到文件]

    *   机器2 只需要放入CentOS的光盘, 启动后按键盘ESC, 输入命令 linux ks=ftp://192.168.1.103/ks.cfg 即可完成

* ks.cfg配置文件详解
    <div class="cnblogs_code">
    <pre># Kickstart <span style="color: #0000ff;">file</span><span style="color: #000000;"> automatically generated by anaconda.

    #version</span>=<span style="color: #000000;">DEVEL
    </span><span style="color: #0000ff;">install</span><span style="color: #000000;">
    url </span>--url=<span style="color: #0000ff;">ftp</span>:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.1.103/pub/CentOS # 配置安装树目录 本文已ftp方式</span>
    lang en_US.UTF-<span style="color: #800080;">8</span><span style="color: #000000;">
    keyboard us
    network </span>--onboot no --device eth0 --mtu=<span style="color: #800080;">1500</span> --bootproto dhcp --<span style="color: #000000;">noipv6 # dhcp方式获取ip
    rootpw  </span>--iscrypted $<span style="color: #800080;">6</span><span style="color: #000000;">$RyFEkouZJLufDNGf$POLwfvq2CHW2BY1qVGFzX6HoX1CsRGvaifo03Zec0uRQnupT.el3fg50b4I3pQRRMFZJqPdW8BypTe0shmZYi.
    # Reboot after installation
    reboot
    firewall </span>--service=<span style="color: #0000ff;">ssh</span><span style="color: #000000;">
    authconfig </span>--enableshadow --passalgo=<span style="color: #000000;">sha512
    selinux </span>--<span style="color: #000000;">enforcing
    timezone </span>--utc Asia/<span style="color: #000000;">Shanghai # 默认时区
    bootloader </span>--location=mbr --driveorder=sda --append=<span style="color: #800000;">"</span><span style="color: #800000;">crashkernel=auto rhgb rhgb quiet quiet</span><span style="color: #800000;">"</span><span style="color: #000000;">
    # The following is the partition information you requested
    # Note that any partitions you deleted are not expressed
    # here so unless you </span><span style="color: #0000ff;">clear</span><span style="color: #000000;"> all partitions first, this is
    # not guaranteed to work
    clearpart </span>--all --drives=<span style="color: #000000;">sda # 删除磁盘

    part </span>/boot --fstype=ext4 --size=<span style="color: #800080;">500</span><span style="color: #000000;"> # 分boot分区
    part </span>/ --fstype=ext4 --size=<span style="color: #800080;">5000</span><span style="color: #000000;"> # 分根分区
    part swap </span>--grow --maxsize=<span style="color: #800080;">1024</span> --size=<span style="color: #800080;">1024</span> # 分swap分区 可以使用 `part swap --<span style="color: #000000;">recommended` 推荐

    repo </span>--name=<span style="color: #800000;">"</span><span style="color: #800000;">CentOS</span><span style="color: #800000;">"</span>  --baseurl=<span style="color: #0000ff;">ftp</span>:<span style="color: #008000;">//</span><span style="color: #008000;">192.168.1.103/pub/CentOS --cost=1000 # 镜像源,包含所有的软件包</span>

    %packages --<span style="color: #000000;">nobase
    @Core # 核心包, 可以自己添加多个

    </span>%<span style="color: #000000;">end

    </span>%<span style="color: #000000;">post
    </span><span style="color: #0000ff;">yum</span> <span style="color: #0000ff;">install</span> -<span style="color: #000000;">y vim # 安装后自动执行脚本 可根据自己定义编写
    </span>%end</pre>
    </div>

配置参数很多,只列出了一点详细可参考官方网站[centos kickstart](http://www.centos.org/docs/5/html/Installation_Guide-en-US/s1-kickstart2-options.html)&nbsp;也可一用软件自动生成ks.cfg文件,搜索软件包&nbsp;`yum search kickstart`&nbsp;出来两个 pykickstart|system-config-kickstart 安装即可
